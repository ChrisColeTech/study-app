"use strict";var p=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var I=Object.prototype.hasOwnProperty;var R=(o,e)=>{for(var t in e)p(o,t,{get:e[t],enumerable:!0})},x=(o,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of P(e))!I.call(o,s)&&s!==t&&p(o,s,{get:()=>e[s],enumerable:!(r=h(e,s))||r.enumerable});return o};var w=o=>x(p({},"__esModule",{value:!0}),o);var f={};R(f,{handler:()=>b});module.exports=w(f);var c=class extends Error{constructor(t,r,s){super(r);this.code=t;this.details=s;this.name="ApiError"}};var n=class{static success(e,t=200,r){let s={success:!0,data:e,message:r,timestamp:new Date().toISOString(),version:this.VERSION};return{statusCode:t,headers:this.CORS_HEADERS,body:JSON.stringify(s)}}static error(e,t="INTERNAL_ERROR",r,s=500){let i={success:!1,error:e,message:`[${t}] ${e}`,timestamp:new Date().toISOString(),version:this.VERSION,...r&&{data:r}};return{statusCode:s,headers:this.CORS_HEADERS,body:JSON.stringify(i)}}static badRequest(e,t){return this.error(e,"VALIDATION_ERROR",t,400)}static unauthorized(e="Unauthorized"){return this.error(e,"UNAUTHORIZED",void 0,401)}static forbidden(e="Forbidden"){return this.error(e,"FORBIDDEN",void 0,403)}static notFound(e="Resource not found"){return this.error(e,"NOT_FOUND",void 0,404)}static rateLimited(e="Rate limit exceeded"){return this.error(e,"RATE_LIMITED",void 0,429)}static internalError(e="Internal server error"){return this.error(e,"INTERNAL_ERROR",void 0,500)}static cors(){return{statusCode:200,headers:{...this.CORS_HEADERS,"Access-Control-Max-Age":"86400"},body:""}}static health(e){return this.success({status:"healthy",timestamp:new Date().toISOString(),version:this.VERSION,environment:process.env.STAGE||"unknown",...e})}static paginated(e,t,r,s,i){let a=Math.ceil(t/s),u=r<a,d=r>1;return this.success({items:e,pagination:{totalCount:t,totalPages:a,currentPage:r,pageSize:s,hasNextPage:u,hasPrevPage:d}},200,i)}};n.VERSION="2.0.0",n.CORS_HEADERS={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Content-Type,Authorization,X-Amz-Date,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,X-Auth-Token","Access-Control-Allow-Methods":"GET,POST,PUT,DELETE,OPTIONS,HEAD","Access-Control-Allow-Credentials":"true","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"};var l=class{constructor(e){this.context=e,this.logLevel=process.env.LOG_LEVEL||"INFO"}info(e,t){this.shouldLog("INFO")&&this.log("INFO",e,t)}debug(e,t){this.shouldLog("DEBUG")&&this.log("DEBUG",e,t)}warn(e,t){this.shouldLog("WARN")&&this.log("WARN",e,t)}error(e,t){let r=t instanceof Error?{name:t.name,message:t.message,stack:t.stack}:t;this.log("ERROR",e,r)}perf(e,t,r){this.info(`Performance: ${e}`,{duration:`${t}ms`,operation:e,...r})}log(e,t,r){let s={timestamp:new Date().toISOString(),level:e,context:this.context,message:t,stage:process.env.STAGE||"unknown",version:"2.0.0",...r&&{data:r}};switch(e){case"ERROR":console.error(JSON.stringify(s));break;case"WARN":console.warn(JSON.stringify(s));break;default:console.log(JSON.stringify(s))}}shouldLog(e){let t=["ERROR","WARN","INFO","DEBUG"],r=t.indexOf(this.logLevel);return t.indexOf(e)<=r}};var g=class{constructor(e){this.handlerName=e;this.version="2.0.0";this.logger=new l(e)}withAuth(e){return async t=>{let r=t.requestContext.requestId,s=`${t.httpMethod} ${t.resource}`;try{if(this.logger.info(`[${r}] ${s} - Request started`,{httpMethod:t.httpMethod,resource:t.resource,userAgent:t.headers["User-Agent"],sourceIp:t.requestContext.identity.sourceIp}),t.httpMethod==="OPTIONS")return n.cors();let i=this.extractUserId(t);if(!i)return this.logger.warn(`[${r}] ${s} - No userId in authorizer context`,{authorizerContext:t.requestContext.authorizer}),n.unauthorized("User not authenticated");this.logger.info(`[${r}] ${s} - Authenticated user: ${i}`);let a=await this.validateRequest(t);if(a)return this.logger.warn(`[${r}] ${s} - Validation failed`,a),n.badRequest(a.message,a);let u=Date.now(),d=await e(t,i),A=Date.now()-u;return this.logger.info(`[${r}] ${s} - Request completed`,{statusCode:d.statusCode,duration:`${A}ms`}),d}catch(i){return this.logger.error(`[${r}] ${s} - Request failed`,i),this.handleError(i)}}}withoutAuth(e){return async t=>{let r=t.requestContext.requestId,s=`${t.httpMethod} ${t.resource}`;try{if(this.logger.info(`[${r}] ${s} - Public request started`),t.httpMethod==="OPTIONS")return n.cors();let i=Date.now(),a=await e(t),u=Date.now()-i;return this.logger.info(`[${r}] ${s} - Public request completed`,{statusCode:a.statusCode,duration:`${u}ms`}),a}catch(i){return this.logger.error(`[${r}] ${s} - Public request failed`,i),this.handleError(i)}}}extractUserId(e){let t=e.requestContext.authorizer;return t&&(t.userId||t.principalId||t.claims?.userId||t.claims?.sub)||null}async validateRequest(e){return null}handleError(e){return e instanceof c?n.error(e.message,e.code,e.details):e.name==="ValidationError"?n.badRequest(e.message):e.name==="UnauthorizedError"?n.unauthorized(e.message):e.name==="ForbiddenError"?n.forbidden(e.message):e.name==="NotFoundError"?n.notFound(e.message):n.internalError("An unexpected error occurred")}parseJsonBody(e){if(!e.body)return null;try{return JSON.parse(e.body)}catch{throw new c("VALIDATION_ERROR","Invalid JSON in request body")}}getQueryParam(e,t,r){return e.queryStringParameters?.[t]||r}getPathParam(e,t){return e.pathParameters?.[t]}getHeader(e,t){return e.headers[t]||e.headers[t.toLowerCase()]}success(e,t){return n.success(e,200,t)}created(e,t){return n.success(e,201,t)}noContent(){return n.success(null,204)}};var y=class extends g{constructor(){super("SessionHandler")}async handleRequest(e,t){let{httpMethod:r}=e;switch(r){case"GET":return this.getSessions(e,t);case"POST":return this.createSession(e,t);default:return this.methodNotAllowed("Method not supported")}}async getSessions(e,t){let r=[{sessionId:"s1",userId:t,provider:"aws",exam:"saa-c03",status:"completed"}];return this.success({sessions:r})}async createSession(e,t){let r=this.parseJsonBody(e),s={sessionId:`s-${Date.now()}`,userId:t,provider:r?.provider||"aws",exam:r?.exam||"saa-c03",status:"active",createdAt:new Date().toISOString()};return this.created(s,"Session created successfully")}methodNotAllowed(e){return{statusCode:405,headers:{"Content-Type":"application/json"},body:JSON.stringify({error:e})}}},m=new y,b=m.withAuth((o,e)=>m.handleRequest(o,e));0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
