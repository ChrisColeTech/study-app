"use strict";var p=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var I=Object.prototype.hasOwnProperty;var R=(o,e)=>{for(var t in e)p(o,t,{get:e[t],enumerable:!0})},x=(o,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of h(e))!I.call(o,s)&&s!==t&&p(o,s,{get:()=>e[s],enumerable:!(r=A(e,s))||r.enumerable});return o};var f=o=>x(p({},"__esModule",{value:!0}),o);var b={};R(b,{handler:()=>E});module.exports=f(b);var d=class extends Error{constructor(t,r,s){super(r);this.code=t;this.details=s;this.name="ApiError"}};var i=class{static success(e,t=200,r){let s={success:!0,data:e,message:r,timestamp:new Date().toISOString(),version:this.VERSION};return{statusCode:t,headers:this.CORS_HEADERS,body:JSON.stringify(s)}}static error(e,t="INTERNAL_ERROR",r,s=500){let n={success:!1,error:e,message:`[${t}] ${e}`,timestamp:new Date().toISOString(),version:this.VERSION,...r&&{data:r}};return{statusCode:s,headers:this.CORS_HEADERS,body:JSON.stringify(n)}}static badRequest(e,t){return this.error(e,"VALIDATION_ERROR",t,400)}static unauthorized(e="Unauthorized"){return this.error(e,"UNAUTHORIZED",void 0,401)}static forbidden(e="Forbidden"){return this.error(e,"FORBIDDEN",void 0,403)}static notFound(e="Resource not found"){return this.error(e,"NOT_FOUND",void 0,404)}static rateLimited(e="Rate limit exceeded"){return this.error(e,"RATE_LIMITED",void 0,429)}static internalError(e="Internal server error"){return this.error(e,"INTERNAL_ERROR",void 0,500)}static cors(){return{statusCode:200,headers:{...this.CORS_HEADERS,"Access-Control-Max-Age":"86400"},body:""}}static health(e){return this.success({status:"healthy",timestamp:new Date().toISOString(),version:this.VERSION,environment:process.env.STAGE||"unknown",...e})}static paginated(e,t,r,s,n){let a=Math.ceil(t/s),u=r<a,c=r>1;return this.success({items:e,pagination:{totalCount:t,totalPages:a,currentPage:r,pageSize:s,hasNextPage:u,hasPrevPage:c}},200,n)}};i.VERSION="2.0.0",i.CORS_HEADERS={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Content-Type,Authorization,X-Amz-Date,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,X-Auth-Token","Access-Control-Allow-Methods":"GET,POST,PUT,DELETE,OPTIONS,HEAD","Access-Control-Allow-Credentials":"true","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"};var l=class{constructor(e){this.context=e,this.logLevel=process.env.LOG_LEVEL||"INFO"}info(e,t){this.shouldLog("INFO")&&this.log("INFO",e,t)}debug(e,t){this.shouldLog("DEBUG")&&this.log("DEBUG",e,t)}warn(e,t){this.shouldLog("WARN")&&this.log("WARN",e,t)}error(e,t){let r=t instanceof Error?{name:t.name,message:t.message,stack:t.stack}:t;this.log("ERROR",e,r)}perf(e,t,r){this.info(`Performance: ${e}`,{duration:`${t}ms`,operation:e,...r})}log(e,t,r){let s={timestamp:new Date().toISOString(),level:e,context:this.context,message:t,stage:process.env.STAGE||"unknown",version:"2.0.0",...r&&{data:r}};switch(e){case"ERROR":console.error(JSON.stringify(s));break;case"WARN":console.warn(JSON.stringify(s));break;default:console.log(JSON.stringify(s))}}shouldLog(e){let t=["ERROR","WARN","INFO","DEBUG"],r=t.indexOf(this.logLevel);return t.indexOf(e)<=r}};var g=class{constructor(e){this.handlerName=e;this.version="2.0.0";this.logger=new l(e)}withAuth(e){return async t=>{let r=t.requestContext.requestId,s=`${t.httpMethod} ${t.resource}`;try{if(this.logger.info(`[${r}] ${s} - Request started`,{httpMethod:t.httpMethod,resource:t.resource,userAgent:t.headers["User-Agent"],sourceIp:t.requestContext.identity.sourceIp}),t.httpMethod==="OPTIONS")return i.cors();let n=this.extractUserId(t);if(!n)return this.logger.warn(`[${r}] ${s} - No userId in authorizer context`,{authorizerContext:t.requestContext.authorizer}),i.unauthorized("User not authenticated");this.logger.info(`[${r}] ${s} - Authenticated user: ${n}`);let a=await this.validateRequest(t);if(a)return this.logger.warn(`[${r}] ${s} - Validation failed`,a),i.badRequest(a.message,a);let u=Date.now(),c=await e(t,n),P=Date.now()-u;return this.logger.info(`[${r}] ${s} - Request completed`,{statusCode:c.statusCode,duration:`${P}ms`}),c}catch(n){return this.logger.error(`[${r}] ${s} - Request failed`,n),this.handleError(n)}}}withoutAuth(e){return async t=>{let r=t.requestContext.requestId,s=`${t.httpMethod} ${t.resource}`;try{if(this.logger.info(`[${r}] ${s} - Public request started`),t.httpMethod==="OPTIONS")return i.cors();let n=Date.now(),a=await e(t),u=Date.now()-n;return this.logger.info(`[${r}] ${s} - Public request completed`,{statusCode:a.statusCode,duration:`${u}ms`}),a}catch(n){return this.logger.error(`[${r}] ${s} - Public request failed`,n),this.handleError(n)}}}extractUserId(e){let t=e.requestContext.authorizer;return t&&(t.userId||t.principalId||t.claims?.userId||t.claims?.sub)||null}async validateRequest(e){return null}handleError(e){return e instanceof d?i.error(e.message,e.code,e.details):e.name==="ValidationError"?i.badRequest(e.message):e.name==="UnauthorizedError"?i.unauthorized(e.message):e.name==="ForbiddenError"?i.forbidden(e.message):e.name==="NotFoundError"?i.notFound(e.message):i.internalError("An unexpected error occurred")}parseJsonBody(e){if(!e.body)return null;try{return JSON.parse(e.body)}catch{throw new d("VALIDATION_ERROR","Invalid JSON in request body")}}getQueryParam(e,t,r){return e.queryStringParameters?.[t]||r}getPathParam(e,t){return e.pathParameters?.[t]}getHeader(e,t){return e.headers[t]||e.headers[t.toLowerCase()]}success(e,t){return i.success(e,200,t)}created(e,t){return i.success(e,201,t)}noContent(){return i.success(null,204)}};var y=class extends g{constructor(){super("ProviderHandler")}async getProviders(e,t){this.logger.info("Fetching providers for user",{userId:t});let r=[{id:"aws",name:"Amazon Web Services",description:"Cloud computing platform and services",exams:[{id:"saa-c03",name:"Solutions Architect Associate",description:"Validates ability to design distributed systems on AWS",questionCount:681,duration:130,passingScore:720},{id:"dva-c01",name:"Developer Associate",description:"Validates ability to develop applications on AWS",questionCount:0,duration:130,passingScore:720},{id:"soa-c02",name:"SysOps Administrator Associate",description:"Validates ability to deploy and manage systems on AWS",questionCount:0,duration:130,passingScore:720}]},{id:"azure",name:"Microsoft Azure",description:"Cloud computing platform and services",exams:[{id:"az-900",name:"Azure Fundamentals",description:"Validates foundational knowledge of cloud services",questionCount:0,duration:60,passingScore:700},{id:"az-104",name:"Azure Administrator",description:"Validates skills to manage Azure subscriptions and resources",questionCount:0,duration:150,passingScore:700},{id:"az-204",name:"Azure Developer",description:"Validates skills to develop cloud solutions",questionCount:0,duration:150,passingScore:700}]},{id:"gcp",name:"Google Cloud Platform",description:"Cloud computing platform and services",exams:[{id:"ace",name:"Associate Cloud Engineer",description:"Validates ability to deploy and manage GCP resources",questionCount:0,duration:120,passingScore:70},{id:"pca",name:"Professional Cloud Architect",description:"Validates ability to design and manage GCP solutions",questionCount:0,duration:120,passingScore:70}]}],s=r.length,n=r.reduce((a,u)=>a+u.exams.length,0);return this.success({providers:r,totalProviders:s,totalExams:n},"Providers retrieved successfully")}async getProvider(e,t){let r=this.getPathParam(e,"providerId");if(!r)return this.badRequest("Provider ID is required");this.logger.info("Fetching specific provider",{userId:t,providerId:r});let n=[].find(a=>a.id===r);return n?this.success(n,`Provider '${r}' retrieved successfully`):this.notFound(`Provider '${r}' not found`)}async handleRequest(e,t){let{httpMethod:r}=e,s=this.getPathParam(e,"providerId");switch(r){case"GET":return s?this.getProvider(e,t):this.getProviders(e,t);default:return this.methodNotAllowed(`${r} method not supported`)}}methodNotAllowed(e){return{statusCode:405,headers:{"Content-Type":"application/json"},body:JSON.stringify({error:e})}}badRequest(e){return{statusCode:400,headers:{"Content-Type":"application/json"},body:JSON.stringify({error:e})}}notFound(e){return{statusCode:404,headers:{"Content-Type":"application/json"},body:JSON.stringify({error:e})}}},m=new y,E=m.withAuth((o,e)=>m.handleRequest(o,e));0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
