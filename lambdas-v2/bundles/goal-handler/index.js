"use strict";var p=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var I=Object.prototype.hasOwnProperty;var R=(o,t)=>{for(var e in t)p(o,e,{get:t[e],enumerable:!0})},x=(o,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of h(t))!I.call(o,s)&&s!==e&&p(o,s,{get:()=>t[s],enumerable:!(r=P(t,s))||r.enumerable});return o};var E=o=>x(p({},"__esModule",{value:!0}),o);var f={};R(f,{handler:()=>b});module.exports=E(f);var c=class extends Error{constructor(e,r,s){super(r);this.code=e;this.details=s;this.name="ApiError"}};var n=class{static success(t,e=200,r){let s={success:!0,data:t,message:r,timestamp:new Date().toISOString(),version:this.VERSION};return{statusCode:e,headers:this.CORS_HEADERS,body:JSON.stringify(s)}}static error(t,e="INTERNAL_ERROR",r,s=500){let i={success:!1,error:t,message:`[${e}] ${t}`,timestamp:new Date().toISOString(),version:this.VERSION,...r&&{data:r}};return{statusCode:s,headers:this.CORS_HEADERS,body:JSON.stringify(i)}}static badRequest(t,e){return this.error(t,"VALIDATION_ERROR",e,400)}static unauthorized(t="Unauthorized"){return this.error(t,"UNAUTHORIZED",void 0,401)}static forbidden(t="Forbidden"){return this.error(t,"FORBIDDEN",void 0,403)}static notFound(t="Resource not found"){return this.error(t,"NOT_FOUND",void 0,404)}static rateLimited(t="Rate limit exceeded"){return this.error(t,"RATE_LIMITED",void 0,429)}static internalError(t="Internal server error"){return this.error(t,"INTERNAL_ERROR",void 0,500)}static cors(){return{statusCode:200,headers:{...this.CORS_HEADERS,"Access-Control-Max-Age":"86400"},body:""}}static health(t){return this.success({status:"healthy",timestamp:new Date().toISOString(),version:this.VERSION,environment:process.env.STAGE||"unknown",...t})}static paginated(t,e,r,s,i){let a=Math.ceil(e/s),u=r<a,d=r>1;return this.success({items:t,pagination:{totalCount:e,totalPages:a,currentPage:r,pageSize:s,hasNextPage:u,hasPrevPage:d}},200,i)}};n.VERSION="2.0.0",n.CORS_HEADERS={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Content-Type,Authorization,X-Amz-Date,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,X-Auth-Token","Access-Control-Allow-Methods":"GET,POST,PUT,DELETE,OPTIONS,HEAD","Access-Control-Allow-Credentials":"true","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"};var l=class{constructor(t){this.context=t,this.logLevel=process.env.LOG_LEVEL||"INFO"}info(t,e){this.shouldLog("INFO")&&this.log("INFO",t,e)}debug(t,e){this.shouldLog("DEBUG")&&this.log("DEBUG",t,e)}warn(t,e){this.shouldLog("WARN")&&this.log("WARN",t,e)}error(t,e){let r=e instanceof Error?{name:e.name,message:e.message,stack:e.stack}:e;this.log("ERROR",t,r)}perf(t,e,r){this.info(`Performance: ${t}`,{duration:`${e}ms`,operation:t,...r})}log(t,e,r){let s={timestamp:new Date().toISOString(),level:t,context:this.context,message:e,stage:process.env.STAGE||"unknown",version:"2.0.0",...r&&{data:r}};switch(t){case"ERROR":console.error(JSON.stringify(s));break;case"WARN":console.warn(JSON.stringify(s));break;default:console.log(JSON.stringify(s))}}shouldLog(t){let e=["ERROR","WARN","INFO","DEBUG"],r=e.indexOf(this.logLevel);return e.indexOf(t)<=r}};var g=class{constructor(t){this.handlerName=t;this.version="2.0.0";this.logger=new l(t)}withAuth(t){return async e=>{let r=e.requestContext.requestId,s=`${e.httpMethod} ${e.resource}`;try{if(this.logger.info(`[${r}] ${s} - Request started`,{httpMethod:e.httpMethod,resource:e.resource,userAgent:e.headers["User-Agent"],sourceIp:e.requestContext.identity.sourceIp}),e.httpMethod==="OPTIONS")return n.cors();let i=this.extractUserId(e);if(!i)return this.logger.warn(`[${r}] ${s} - No userId in authorizer context`,{authorizerContext:e.requestContext.authorizer}),n.unauthorized("User not authenticated");this.logger.info(`[${r}] ${s} - Authenticated user: ${i}`);let a=await this.validateRequest(e);if(a)return this.logger.warn(`[${r}] ${s} - Validation failed`,a),n.badRequest(a.message,a);let u=Date.now(),d=await t(e,i),m=Date.now()-u;return this.logger.info(`[${r}] ${s} - Request completed`,{statusCode:d.statusCode,duration:`${m}ms`}),d}catch(i){return this.logger.error(`[${r}] ${s} - Request failed`,i),this.handleError(i)}}}withoutAuth(t){return async e=>{let r=e.requestContext.requestId,s=`${e.httpMethod} ${e.resource}`;try{if(this.logger.info(`[${r}] ${s} - Public request started`),e.httpMethod==="OPTIONS")return n.cors();let i=Date.now(),a=await t(e),u=Date.now()-i;return this.logger.info(`[${r}] ${s} - Public request completed`,{statusCode:a.statusCode,duration:`${u}ms`}),a}catch(i){return this.logger.error(`[${r}] ${s} - Public request failed`,i),this.handleError(i)}}}extractUserId(t){let e=t.requestContext.authorizer;return e&&(e.userId||e.principalId||e.claims?.userId||e.claims?.sub)||null}async validateRequest(t){return null}handleError(t){return t instanceof c?n.error(t.message,t.code,t.details):t.name==="ValidationError"?n.badRequest(t.message):t.name==="UnauthorizedError"?n.unauthorized(t.message):t.name==="ForbiddenError"?n.forbidden(t.message):t.name==="NotFoundError"?n.notFound(t.message):n.internalError("An unexpected error occurred")}parseJsonBody(t){if(!t.body)return null;try{return JSON.parse(t.body)}catch{throw new c("VALIDATION_ERROR","Invalid JSON in request body")}}getQueryParam(t,e,r){return t.queryStringParameters?.[e]||r}getPathParam(t,e){return t.pathParameters?.[e]}getHeader(t,e){return t.headers[e]||t.headers[e.toLowerCase()]}success(t,e){return n.success(t,200,e)}created(t,e){return n.success(t,201,e)}noContent(){return n.success(null,204)}};var y=class extends g{constructor(){super("GoalHandler")}async getGoals(t,e){let r=[{goalId:"g1",userId:e,title:"Pass AWS SAA-C03",status:"active",progress:65}];return this.success({goals:r})}},A=new y,b=A.withAuth((o,t)=>A.getGoals(o,t));0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
